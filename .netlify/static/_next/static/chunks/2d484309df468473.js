(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52071,e=>{"use strict";e.s(["default",()=>D],52071);var t=e.i(43476),a=e.i(71645);let r=a.forwardRef(function(e,t){let{title:r,titleId:l,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"}))});var l=e.i(75272);let n=a.forwardRef(function(e,t){let{title:r,titleId:l,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"}))}),s=a.forwardRef(function(e,t){let{title:r,titleId:l,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"}))});var i=e.i(39875);let o=a.forwardRef(function(e,t){let{title:r,titleId:l,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))});var d=e.i(47604),c=e.i(33576),u=e.i(44735),g=e.i(55344),m=e.i(83642),x=e.i(70011),h=e.i(37163),f=e.i(50057),y=e.i(24166);let p=a.default.memo(e=>{var a;let{chat:r,user:l,isSelected:n,onSelect:s,onlineFriends:i}=e,o=(e=>{if("direct"===e.type){var t,a,r;let n=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==l?void 0:l.id));return(null==n||null==(a=n.user_profile)?void 0:a.full_name)||(null==n||null==(r=n.user_profile)?void 0:r.username)||"Unknown User"}return e.name||"Group Chat"})(r),d=(e=>{if("direct"===e.type){var t,a;let r=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==l?void 0:l.id));return null==r||null==(a=r.user_profile)?void 0:a.avatar_url}return null})(r),c=(e=>{var t,a,r,n,s,i;if("direct"===e.type){let t=null==(a=e.participants)?void 0:a.find(e=>e.user_id!==(null==l?void 0:l.id));return(null==t||null==(n=t.user_profile)||null==(r=n.full_name)?void 0:r[0])||(null==t||null==(i=t.user_profile)||null==(s=i.username)?void 0:s[0])||"?"}return(null==(t=e.name)?void 0:t[0])||"G"})(r),u=(e=>{if("direct"===e.type){var t;let a=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==l?void 0:l.id));return a&&i.includes(a.user_id)}return!1})(r),g=r.last_message_at?new Date(r.last_message_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return(0,t.jsxs)("div",{onClick:()=>s(r.id),className:"\n        flex items-center px-4 py-3.5 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-colors border-b border-gray-100 dark:border-gray-800\n        ".concat(n?"bg-primary-50 dark:bg-primary-900/20 lg:border-l-4 lg:border-primary-600":"","\n      "),children:[(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[d?(0,t.jsx)("img",{src:d,alt:o,className:"w-12 h-12 rounded-full object-cover shadow-md"}):(0,t.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-primary-500 to-accent-500 rounded-full flex items-center justify-center text-white font-bold text-base shadow-md",children:c}),u&&(0,t.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 rounded-full border-2 border-white dark:border-gray-800 shadow-sm"})]}),(0,t.jsxs)("div",{className:"ml-3 flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("p",{className:"text-base font-bold text-gray-900 dark:text-white truncate",children:o}),"direct"===r.type&&(()=>{var e,a,n;let s=null==(e=r.participants)?void 0:e.find(e=>e.user_id!==(null==l?void 0:l.id)),i=(e=>{if(!e)return"";let t=y.countries.find(t=>t.name===e);return(null==t?void 0:t.flag)||""})((null==s||null==(a=s.user_profile)?void 0:a.location)||void 0);return i?(0,t.jsx)("span",{className:"text-lg",title:(null==s||null==(n=s.user_profile)?void 0:n.location)||void 0,children:i}):null})()]}),(0,t.jsx)("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 ml-2 flex-shrink-0",children:g})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center mt-0.5",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate pr-2",children:(null==(a=r.last_message)?void 0:a.content)||"No messages yet"}),r.unread_count&&r.unread_count>0&&(0,t.jsx)("span",{className:"ml-auto bg-primary-600 text-white text-xs font-bold rounded-full px-2 py-0.5 flex-shrink-0 shadow-sm min-w-[20px] text-center",children:r.unread_count})]})]})]})});p.displayName="ChatItem";var b=e.i(27217),v=e.i(62060);let w=a.forwardRef(function(e,t){let{title:r,titleId:l,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M22 10.5h-6m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM4 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 10.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))});var j=e.i(65300);function k(e){let{isOpen:r,onClose:l,friendProfile:n}=e,{user:s}=(0,m.useAuth)(),{friends:i}=(0,h.useFriends)(),[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)("none"),g=null==i?void 0:i.some(e=>{var t;return(null==(t=e.friend_profile)?void 0:t.id)===n.id});a.default.useEffect(()=>{s&&n.id&&j.FriendsService.getFriendRequestStatus(s.id,n.id).then(e=>{u(e.status)}).catch(e=>{console.error("Error checking friend status:",e)})},[s,n.id]);let x=async()=>{if(s&&!o){d(!0);try{await j.FriendsService.sendFriendRequest(s.id,n.id,"Hi! I saw you mentioned in a chat and wanted to connect."),u("pending_sent")}catch(e){console.error("Error sending friend request:",e)}finally{d(!1)}}},f=async()=>{if(s&&!o){d(!0);try{u("accepted")}catch(e){console.error("Error accepting friend request:",e)}finally{d(!1)}}};return r?(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Friend Profile"}),(0,t.jsx)("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,t.jsx)(b.XMarkIcon,{className:"w-6 h-6"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center text-white font-bold text-2xl shadow-lg",children:n.avatar_url?(0,t.jsx)("img",{src:n.avatar_url,alt:n.full_name||"Friend",className:"w-20 h-20 rounded-full object-cover"}):(0,t.jsx)("span",{children:(n.full_name||n.username||"F")[0].toUpperCase()})}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-1",children:n.full_name||n.username||"Unknown User"}),n.username&&n.full_name&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["@",n.username]}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(n.is_online?"bg-green-500":"bg-gray-400")}),(0,t.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:n.is_online?"Online":"Offline"})]}),(0,t.jsx)("div",{className:"text-sm font-medium ".concat((()=>{switch(c){case"accepted":return"text-green-600 dark:text-green-400";case"pending_sent":return"text-yellow-600 dark:text-yellow-400";case"pending_received":return"text-blue-600 dark:text-blue-400";case"declined":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}})()),children:(()=>{switch(c){case"accepted":return"You are friends";case"pending_sent":return"Friend request sent";case"pending_received":return"Wants to be friends";case"declined":return"Friend request declined";default:return"Not friends yet"}})()})]}),n.bio&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Bio"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:n.bio})]}),n.location&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Location"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:n.location})]}),(0,t.jsx)("div",{className:"pt-4",children:(()=>{if(g)return(0,t.jsxs)("button",{disabled:!0,className:"w-full px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-500 dark:text-gray-400 rounded-lg cursor-not-allowed flex items-center justify-center space-x-2",children:[(0,t.jsx)(w,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:"Already Friends"})]});switch(c){case"pending_sent":return(0,t.jsxs)("button",{disabled:!0,className:"w-full px-4 py-2 bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300 rounded-lg cursor-not-allowed flex items-center justify-center space-x-2",children:[(0,t.jsx)(v.UserPlusIcon,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:"Request Sent"})]});case"pending_received":return(0,t.jsxs)("button",{onClick:f,disabled:o,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center space-x-2 disabled:opacity-50",children:[(0,t.jsx)(v.UserPlusIcon,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:o?"Accepting...":"Accept Request"})]});case"declined":return(0,t.jsxs)("button",{onClick:x,disabled:o,className:"w-full px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg flex items-center justify-center space-x-2 disabled:opacity-50",children:[(0,t.jsx)(v.UserPlusIcon,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:o?"Sending...":"Send Request Again"})]});default:return(0,t.jsxs)("button",{onClick:x,disabled:o,className:"w-full px-4 py-2 bg-primary-600 hover:bg-primary-700 text-black rounded-lg flex items-center justify-center space-x-2 disabled:opacity-50",children:[(0,t.jsx)(v.UserPlusIcon,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:o?"Sending...":"Send Friend Request"})]})}})()})]})]})}):null}var N=e.i(17927);e.i(47167);var _=e.i(99749);class C{static async translate(e,t,a,r){try{var l,n,s,i,o,d;if(!e||!e.trim())throw Error("Text to translate cannot be empty");if(!t)throw Error("Target language is required");let c=C.getCacheKey(e,t,a),u=C.getCachedTranslation(c);if(u)return console.log("🌐 Translation served from cache"),u;if(!C.API_KEY)return console.warn("⚠️ Google Translate API key not configured"),console.log("🔍 API Key Debug:",{hasKey:!!C.API_KEY,keyLength:(null==(i=C.API_KEY)?void 0:i.length)||0,keyStart:(null==(o=C.API_KEY)?void 0:o.substring(0,10))||"none"}),e;let g={q:e,target:t,format:"text",...a&&{source:a}};console.log("🌐 Translating text:",{text:e.substring(0,50)+"...",targetLanguage:t});let m=await fetch("".concat(C.API_URL,"?key=").concat(C.API_KEY),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g),signal:r});if(!m.ok){let e=await m.json().catch(()=>({}));throw Error("Translation API error: ".concat(m.status," - ").concat((null==(d=e.error)?void 0:d.message)||"Unknown error"))}let x=await m.json();if(!(null==(s=x.data)||null==(n=s.translations)||null==(l=n[0])?void 0:l.translatedText))throw Error("Invalid translation response");let h=x.data.translations[0].translatedText;return C.cacheTranslation(c,h),console.log("✅ Translation successful:",h.substring(0,50)+"..."),h}catch(t){return console.error("🔴 Translation error:",t),e}}async translateBatch(e,t,a){try{let r=e.map(e=>C.translate(e,t,a));return await Promise.all(r)}catch(t){return console.error("🔴 Batch translation error:",t),e}}async detectLanguage(e){try{var t,a,r,l;if(!C.API_KEY)return"en";let n=await fetch("".concat(C.API_URL,"/detect?key=").concat(C.API_KEY),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:e})});if(!n.ok)throw Error("Language detection API error: ".concat(n.status));return(null==(l=(await n.json()).data)||null==(r=l.detections)||null==(a=r[0])||null==(t=a[0])?void 0:t.language)||"en"}catch(e){return console.error("🔴 Language detection error:",e),"en"}}static getCachedTranslation(e){let t=C.cache[e];return t&&Date.now()<t.expiresAt?t.translation:(t&&delete C.cache[e],null)}static cacheTranslation(e,t){if(Object.keys(C.cache).length>=C.MAX_CACHE_SIZE&&(C.cleanExpiredCache(),Object.keys(C.cache).length>=C.MAX_CACHE_SIZE)){let e=Object.entries(C.cache);e.sort((e,t)=>e[1].timestamp-t[1].timestamp);let t=Math.floor(.2*e.length);for(let a=0;a<t;a++)delete C.cache[e[a][0]]}C.cache[e]={translation:t,timestamp:Date.now(),expiresAt:Date.now()+C.CACHE_DURATION}}static getCacheKey(e,t,a){return"".concat(e.toLowerCase(),"_").concat(t,"_").concat(a||"auto")}static cleanExpiredCache(){let e=Date.now();Object.keys(C.cache).forEach(t=>{C.cache[t].expiresAt<e&&delete C.cache[t]})}static getCacheStats(){return{size:Object.keys(C.cache).length,entries:Object.keys(C.cache)}}static clearCache(){C.cache={}}}(0,_._)(C,"cache",{}),(0,_._)(C,"CACHE_DURATION",864e5),(0,_._)(C,"MAX_CACHE_SIZE",1e3),(0,_._)(C,"API_KEY","AIzaSyA_BvHV9rf3SS-2MKWIL-f8bYfp1nGpm0g"),(0,_._)(C,"API_URL","https://translation.googleapis.com/language/translate/v2");let S={translate:/^#translate\s+"([^"]+)"\s+to\s+(\w+)$/i,translateShort:/^#t\s+"([^"]+)"\s+to\s+(\w+)$/i,help:/^#help$/i},E={english:"en",spanish:"es",portuguese:"pt",french:"fr",german:"de",italian:"it",chinese:"zh",japanese:"ja",korean:"ko",arabic:"ar",hindi:"hi",russian:"ru",dutch:"nl",polish:"pl",thai:"th",vietnamese:"vi"};class A{static parseCommand(e){let t=e.trim();for(let[e,a]of Object.entries(S)){let r=t.match(a);if(r)switch(e){case"translate":case"translateShort":return{type:"translate",text:r[1],targetLanguage:this.normalizeLanguage(r[2])};case"help":return{type:"help"}}}return null}static isCommand(e){return null!==this.parseCommand(e)}static normalizeLanguage(e){let t=e.toLowerCase();return E[t]||t}static getHelpText(){return'\n🌐 Translation Commands:\n\n#translate "text" to language\n#t "text" to language\n  • Translate specific text to a language\n  • Example: #translate "Hello" to Spanish\n\n#help\n  • Show this help message\n\nSupported languages: English, Spanish, Portuguese, French, German, Italian, Chinese, Japanese, Korean, Arabic, Hindi, Russian, Dutch, Polish, Thai, Vietnamese\n    '.trim()}}class T{static getSettings(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e)return JSON.parse(e)}catch(e){console.error("Error loading translation settings:",e)}return{}}static updateSettings(e){try{let t={...this.getSettings(),...e};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(e){console.error("Error saving translation settings:",e)}}static resetSettings(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(e){console.error("Error resetting translation settings:",e)}}}(0,_._)(T,"STORAGE_KEY","translation_settings");class I{static shouldTranslate(e,t,a,r){return A.isCommand(e),!1}static needsTranslation(e,t){return this.getLanguageFromCountry(e)!==this.getLanguageFromCountry(t)}static getLanguageFromCountry(e){return({Canada:"en","United States":"en",Mexico:"es",Brazil:"pt",Argentina:"es",Chile:"es",Colombia:"es",Peru:"es",Venezuela:"es",France:"fr",Germany:"de",Italy:"it",Spain:"es","United Kingdom":"en",Netherlands:"nl",Poland:"pl",Russia:"ru",China:"zh",Japan:"ja","South Korea":"ko",India:"hi",Thailand:"th",Vietnam:"vi","Saudi Arabia":"ar",Egypt:"ar","South Africa":"en",Nigeria:"en",Australia:"en","New Zealand":"en"})[e]||"en"}}let L=[{country:"Canada",language:"English",languageCode:"en",flag:"🇨🇦"},{country:"United States",language:"English",languageCode:"en",flag:"🇺🇸"},{country:"Mexico",language:"Spanish",languageCode:"es",flag:"🇲🇽"},{country:"Brazil",language:"Portuguese",languageCode:"pt",flag:"🇧🇷"},{country:"Argentina",language:"Spanish",languageCode:"es",flag:"🇦🇷"},{country:"Chile",language:"Spanish",languageCode:"es",flag:"🇨🇱"},{country:"Colombia",language:"Spanish",languageCode:"es",flag:"🇨🇴"},{country:"Peru",language:"Spanish",languageCode:"es",flag:"🇵🇪"},{country:"Venezuela",language:"Spanish",languageCode:"es",flag:"🇻🇪"},{country:"France",language:"French",languageCode:"fr",flag:"🇫🇷"},{country:"Germany",language:"German",languageCode:"de",flag:"🇩🇪"},{country:"Italy",language:"Italian",languageCode:"it",flag:"🇮🇹"},{country:"Spain",language:"Spanish",languageCode:"es",flag:"🇪🇸"},{country:"United Kingdom",language:"English",languageCode:"en",flag:"🇬🇧"},{country:"Netherlands",language:"Dutch",languageCode:"nl",flag:"🇳🇱"},{country:"Poland",language:"Polish",languageCode:"pl",flag:"🇵🇱"},{country:"Russia",language:"Russian",languageCode:"ru",flag:"🇷🇺"},{country:"China",language:"Chinese",languageCode:"zh",flag:"🇨🇳"},{country:"Japan",language:"Japanese",languageCode:"ja",flag:"🇯🇵"},{country:"South Korea",language:"Korean",languageCode:"ko",flag:"🇰🇷"},{country:"India",language:"Hindi",languageCode:"hi",flag:"🇮🇳"},{country:"Thailand",language:"Thai",languageCode:"th",flag:"🇹🇭"},{country:"Vietnam",language:"Vietnamese",languageCode:"vi",flag:"🇻🇳"},{country:"Saudi Arabia",language:"Arabic",languageCode:"ar",flag:"🇸🇦"},{country:"Egypt",language:"Arabic",languageCode:"ar",flag:"🇪🇬"},{country:"South Africa",language:"English",languageCode:"en",flag:"🇿🇦"},{country:"Nigeria",language:"English",languageCode:"en",flag:"🇳🇬"},{country:"Australia",language:"English",languageCode:"en",flag:"🇦🇺"},{country:"New Zealand",language:"English",languageCode:"en",flag:"🇳🇿"}];function R(e){let t=L.find(t=>t.country.toLowerCase()===e.toLowerCase());return(null==t?void 0:t.languageCode)||"en"}function M(e){return L.find(t=>t.country.toLowerCase()===e.toLowerCase())||null}let P=a.forwardRef(function(e,t){let{title:r,titleId:l,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"}))});var U=e.i(79259);let O=(e,a,r)=>e.split(/@(\w+)/g).map((e,l)=>l%2==1?(0,t.jsxs)("button",{onClick:()=>r(e),className:"font-medium cursor-pointer hover:opacity-80 transition-opacity ".concat(a?"text-primary-100 bg-primary-500/20 px-1 rounded":"text-primary-600 bg-primary-100 dark:bg-primary-900/20 px-1 rounded"),children:["@",e]},l):e),F=a.default.memo(e=>{var r,l;let{message:n,isOwnMessage:s,user:i,otherUserProfile:o,onReply:d,onEdit:c}=e,{profile:u}=(0,m.useAuth)(),g=n.sender_profile,x=new Date(n.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),[h,f]=(0,a.useState)(!1),[p,b]=(0,a.useState)(null),v=(null==g?void 0:g.location)||"",w=s?(null==o?void 0:o.location)||"":(null==u?void 0:u.location)||"",{translation:j,isLoading:_,error:S,isCommand:E,commandResult:L}=function(e,t){let{enabled:r=!0,senderCountry:l,receiverCountry:n}=t,[s,i]=(0,a.useState)(""),[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(null),[g,m]=(0,a.useState)(),x=(0,a.useRef)(null),h=T.getSettings(),f=A.isCommand(e),y=(0,a.useCallback)(async e=>{let t=A.parseCommand(e);if(t)switch(t.type){case"translate":if(t.text&&t.targetLanguage){d(!0),u(null);try{let e=await C.translate(t.text,t.targetLanguage);m('🌐 Translation: "'.concat(e,'"'))}catch(e){u(e.message||"Failed to translate"),m("❌ Translation failed: ".concat(e.message))}finally{d(!1)}}break;case"help":m(A.getHelpText())}},[]),p=(0,a.useCallback)(async()=>{if(!r||!(null==e?void 0:e.trim())||f||!I.shouldTranslate(e,l,n,h)){i(""),d(!1),u(null);return}d(!0),u(null),i(""),x.current&&x.current.abort(),x.current=new AbortController;let t=x.current.signal;try{let a=R(l),r=R(n);if(!a||!r)throw Error("Could not determine sender or receiver language from country.");let s=await C.translate(e,r,a,t);i(s)}catch(t){if("AbortError"===t.name)return;console.error("🔴 Translation hook error:",t),u(t.message||"Failed to translate message."),i(e)}finally{d(!1)}},[e,l,n,r,f,h]);return(0,a.useEffect)(()=>{f?y(e):m(void 0)},[f,e,y]),(0,a.useEffect)(()=>{f||p()},[f,p]),(0,a.useEffect)(()=>()=>{x.current&&x.current.abort()},[]),{translation:s,isLoading:o,error:c,isCommand:f,commandResult:g}}(n.content,{enabled:!0,senderCountry:v,receiverCountry:w}),F=M(v);M(w);let K=async e=>{try{let{data:t,error:a}=await N.supabase.from("user_profiles").select("id, full_name, username, avatar_url, bio, location, is_online, last_seen").or("username.ilike.%".concat(e,"%,full_name.ilike.%").concat(e,"%")).limit(1);if(a)return void console.error("Error searching for user:",a);t&&t.length>0?(b(t[0]),f(!0)):console.log("User not found:",e)}catch(e){console.error("Error handling mention click:",e)}};return(0,t.jsxs)("div",{className:"flex ".concat(s?"justify-end":"justify-start"),children:[(0,t.jsxs)("div",{className:"group max-w-[75%] sm:max-w-xs lg:max-w-md px-4 py-3 rounded-2xl shadow-md\n        ".concat(s?"bg-primary-600 text-black ml-12":"bg-white dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 text-gray-900 dark:text-white mr-12","\n      "),children:[!s&&g&&(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-1 ".concat(s?"text-primary-50":"text-gray-800 dark:text-gray-200"),children:[(0,t.jsx)("p",{className:"text-xs font-bold",children:g.full_name||g.username||"Unknown User"}),(()=>{let e=(e=>{if(!e)return"";let t=y.countries.find(t=>t.name===e);return(null==t?void 0:t.flag)||""})(g.location||void 0);return e?(0,t.jsx)("span",{className:"text-sm",title:g.location||void 0,children:e}):null})()]}),n.reply_to_id&&n.reply_to_message&&(0,t.jsxs)("div",{className:"mb-2 p-2 rounded-lg border-l-4 ".concat(s?"bg-primary-500/10 border-primary-500":"bg-gray-100 dark:bg-gray-600 border-gray-400"),children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,t.jsx)(P,{className:"w-3 h-3 ".concat(s?"text-primary-400":"text-gray-500")}),(0,t.jsxs)("span",{className:"text-xs font-medium ".concat(s?"text-primary-300":"text-gray-600 dark:text-gray-400"),children:["Replying to ",(null==(r=n.reply_to_message.sender_profile)?void 0:r.full_name)||(null==(l=n.reply_to_message.sender_profile)?void 0:l.username)||"Unknown"]})]}),(0,t.jsx)("p",{className:"text-xs truncate ".concat(s?"text-primary-200":"text-gray-700 dark:text-gray-300"),children:n.reply_to_message.content})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[E&&L&&(0,t.jsx)("div",{className:"rounded-lg p-3 border-l-4 border-blue-500 ".concat(s?"bg-blue-500/10":"bg-blue-50 dark:bg-blue-900/20"),children:(0,t.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,t.jsx)("span",{className:"text-blue-500 text-lg",children:"⚡"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium ".concat(s?"text-blue-100":"text-blue-800 dark:text-blue-200"),children:"Command Result:"}),(0,t.jsx)("pre",{className:"text-xs mt-1 whitespace-pre-wrap break-words ".concat(s?"text-blue-200":"text-blue-700 dark:text-blue-300"),children:L})]})]})}),(0,t.jsx)("p",{className:"text-sm sm:text-base leading-relaxed break-words font-medium ".concat(s?"text-black":"text-gray-900 dark:text-gray-100"),children:O(n.content,s,K)}),!E&&j&&j!==n.content&&(0,t.jsxs)("div",{className:"relative",children:[_&&(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-500 dark:text-gray-400",children:[(0,t.jsx)("div",{className:"w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("span",{children:"Translating..."})]}),j&&!_&&(0,t.jsxs)("div",{className:"rounded-lg p-2 border-l-2 border-primary-500 ".concat(s?"bg-primary-500/10":"bg-gray-50 dark:bg-gray-600"),children:[(0,t.jsx)("p",{className:"text-sm leading-relaxed break-words ".concat(s?"text-primary-100":"text-gray-800 dark:text-gray-200"),children:O(j,s,K)}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,t.jsxs)("span",{className:"text-xs flex items-center space-x-1 ".concat(s?"text-primary-200":"text-gray-500 dark:text-gray-400"),children:[(0,t.jsx)("span",{children:"🌐"}),(0,t.jsxs)("span",{children:["Translated from ",(null==F?void 0:F.language)||"Unknown"]})]}),S&&(0,t.jsx)("span",{className:"text-xs text-red-500",title:S,children:"⚠️"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-1.5",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("p",{className:"\n              text-xs text-black font-semibold\n              ".concat(s?"text-primary-100":"text-gray-600 dark:text-gray-400","\n            "),children:x}),n.edited_at&&(0,t.jsx)("span",{className:"text-xs ".concat(s?"text-primary-200":"text-gray-500 dark:text-gray-500"),children:"(edited)"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,t.jsx)("button",{onClick:()=>null==d?void 0:d(n),className:"p-1 rounded-full hover:bg-opacity-20 transition-colors ".concat(s?"hover:bg-primary-200 text-primary-200":"hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-500 dark:text-gray-400"),title:"Reply to message",children:(0,t.jsx)(P,{className:"w-4 h-4"})}),s&&(0,t.jsx)("button",{onClick:()=>null==c?void 0:c(n),className:"p-1 rounded-full hover:bg-primary-200 hover:bg-opacity-20 text-primary-200 transition-colors",title:"Edit message",children:(0,t.jsx)(U.PencilIcon,{className:"w-4 h-4"})})]})]})]}),p&&(0,t.jsx)(k,{isOpen:h,onClose:()=>{f(!1),b(null)},friendProfile:p})]})});F.displayName="MessageBubble";let K=e=>{let{typingUsers:a,className:r=""}=e;if(!a||0===a.length)return null;let l=e=>e.full_name||e.username||"Someone";return(0,t.jsxs)("div",{className:"flex items-center space-x-3 px-4 py-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 ".concat(r),children:[(0,t.jsx)("div",{className:"flex items-center space-x-1",children:(0,t.jsxs)("div",{className:"flex space-x-1",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})}),(0,t.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300 italic font-medium",children:1===a.length?"".concat(l(a[0])," is typing..."):2===a.length?"".concat(l(a[0])," and ").concat(l(a[1])," are typing..."):"".concat(l(a[0])," and ").concat(a.length-1," others are typing...")})]})};function D(){var e,b,v,w,j,k,N;let[_,C]=(0,a.useState)(null),[S,E]=(0,a.useState)(""),[A,T]=(0,a.useState)(""),[I,L]=(0,a.useState)(!1),[R,M]=(0,a.useState)([]),[P,U]=(0,a.useState)(!1),[O,D]=(0,a.useState)(0),[z,B]=(0,a.useState)(null),[G,H]=(0,a.useState)(null),[q,Y]=(0,a.useState)([]),[Z,W]=(0,a.useState)(!1),[J,V]=(0,a.useState)(0),[$,X]=(0,a.useState)(""),[Q,ee]=(0,a.useState)(0),{chats:et,setCurrentChat:ea,sendMessage:er,markMessagesAsRead:el,onlineFriends:en,typingIndicators:es,handleTyping:ei}=(0,g.useRealtime)(),{user:eo}=(0,m.useAuth)(),{friends:ed}=(0,h.useFriends)(),ec=(0,a.useRef)(null),eu=(0,a.useRef)(null),eg={food:["🍕","🍔","🍜","🥘","🍛","🌮","🍱","🍝","🍲","🥗"],happy:["😊","😄","🎉","👏","🥳","✨","💫","😃","🙂","😁"],love:["❤️","💕","😍","🥰","💖","💝","🌹","💘","💗","😘"],travel:["✈️","🌍","🗺️","🏔️","🏖️","🚗","🎒","🏕️","🚁","🚂"],work:["💼","📊","💻","📈","⚙️","📝","✏️","📋","📌","🔧"],sports:["⚽","🏀","🏈","🎾","⛳","🏃‍♀️","🚴","🏊","🏋️","🎯"],music:["🎵","🎶","🎸","🎤","🎧","🎹","🎺","🎻","🥁","🎼"],nature:["🌳","🌸","🌺","🏞️","⛰️","🌊","☀️","🌙","⭐","🌿"],party:["🎉","🍾","🥂","🎊","🪩","💃","🕺","🎈","🎁","🎪"],coffee:["☕","🍵","☕️","🥤","🧊","🍯","🥛","🍰","🧁","🍪"]},{messages:em,loading:ex,error:eh,sendMessage:ef,editMessage:ey,isSending:ep}=function(e){let{chatId:t,limit:r=50}=e,{messages:l,sendMessage:n,loadChatMessages:s}=(0,g.useRealtime)(),{user:i}=(0,m.useAuth)(),[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(null),[h,f]=(0,a.useState)(!0),[y,p]=(0,a.useState)(!1),[b,v]=(0,a.useState)(0);(0,a.useRef)(null);let w=(0,a.useMemo)(()=>l.filter(e=>e.chat_id===t),[l,t]);(0,a.useEffect)(()=>{t&&(null==i?void 0:i.id)&&(async()=>{d(!0),u(null);try{await s(t),v(r),f(!0)}catch(e){u(e instanceof Error?e.message:"Failed to load messages")}finally{d(!1)}})()},[t,null==i?void 0:i.id,s]);let j=(0,a.useCallback)(async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(t&&(null==i?void 0:i.id)){d(!0),u(null);try{let a=await x.ChatsService.getChatMessages(t,i.id,r,e?0:b);e?v(r):v(e=>e+r),f(a.length===r)}catch(e){u(e instanceof Error?e.message:"Failed to load messages")}finally{d(!1)}}},[t,null==i?void 0:i.id,r,b]),k=(0,a.useCallback)(async()=>{h&&!o&&await j(!1)},[h,o,j]),N=(0,a.useCallback)(async(e,a)=>{if(e.trim()&&t&&!y){p(!0),u(null);try{await n(t,e,a)}catch(e){u(e instanceof Error?e.message:"Failed to send message")}finally{p(!1)}}},[t,n,y]);return{messages:w,loading:o,error:c,hasMore:h,loadMore:k,sendMessage:N,editMessage:(0,a.useCallback)(async(e,t)=>{if(t.trim())try{await x.ChatsService.editMessage(e,(null==i?void 0:i.id)||"",t)}catch(e){u(e instanceof Error?e.message:"Failed to edit message")}},[i]),deleteMessage:(0,a.useCallback)(async e=>{try{await x.ChatsService.deleteMessage(e,(null==i?void 0:i.id)||"")}catch(e){u(e instanceof Error?e.message:"Failed to delete message")}},[i]),isSending:y}}({chatId:_||"",limit:50}),eb=et.find(e=>e.id===_),ev=(0,a.useCallback)(async()=>{if(S.trim()&&_&&!ep)try{G?(await ey(G.id,S.trim()),H(null)):(await ef(S.trim(),null==z?void 0:z.id),B(null)),E("")}catch(e){console.error("Error sending message:",e)}},[S,_,ep,ef,G,z]),ew=(0,a.useCallback)(e=>{B(e),H(null),E("")},[]),ej=(0,a.useCallback)(e=>{H(e),B(null),E(e.content)},[]),ek=(0,a.useCallback)(()=>{B(null),H(null),E("")},[]),eN=(0,a.useCallback)(async e=>{C(e);let t=et.find(t=>t.id===e);t&&(ea(t),await el(e),setTimeout(()=>{eR()},100),setTimeout(()=>{eR()},300))},[et,ea,el]),e_=(0,a.useCallback)(e=>{var t,a;let r=(null==(t=e.friend_profile)?void 0:t.username)||(null==(a=e.friend_profile)?void 0:a.full_name)||"Unknown",l=S.lastIndexOf("@friends"),n=S.substring(0,l),s=S.substring(S.lastIndexOf("@")+8),i=s;if($){let e=s.indexOf("/");-1!==e&&(i=s.substring(e+1+$.length))}E(n+"@".concat(r," ")+i),W(!1),X("")},[S,J,$]),eC=(0,a.useCallback)(e=>{if("Enter"!==e.key||e.shiftKey)"ArrowDown"===e.key&&Z&&q.length>0?(e.preventDefault(),ee(e=>e<q.length-1?e+1:0)):"ArrowUp"===e.key&&Z&&q.length>0?(e.preventDefault(),ee(e=>e>0?e-1:q.length-1)):"Escape"===e.key&&Z&&(e.preventDefault(),W(!1),X(""));else{if(e.preventDefault(),Z&&q.length>0){let e=q[Q];if(e)return void e_(e)}ev()}},[ev,Z,q,Q,e_]),eS=(0,a.useCallback)(e=>{let t=e.target.value;E(t),_&&ei(_);let a=t.match(/#(\w+)$/);if(a){let e=a[1].toLowerCase();eg[e]?(M(eg[e]),U(!0),D(t.lastIndexOf("#")),W(!1)):U(!1)}else U(!1);let r=t.match(/@friends(\/(.*))?$/);if(r&&ed&&ed.length>0){let e=r[2]||"";X(e);let a=ed;e&&(a=ed.filter(t=>{var a,r,l,n;let s=(null==(r=t.friend_profile)||null==(a=r.full_name)?void 0:a.toLowerCase())||"",i=(null==(n=t.friend_profile)||null==(l=n.username)?void 0:l.toLowerCase())||"";return e.toLowerCase().split(" ").filter(e=>e.length>0).every(e=>s.includes(e)||i.includes(e))})).sort((t,a)=>{var r,l,n,s;let i=((null==(r=t.friend_profile)?void 0:r.full_name)||(null==(l=t.friend_profile)?void 0:l.username)||"").toLowerCase(),o=((null==(n=a.friend_profile)?void 0:n.full_name)||(null==(s=a.friend_profile)?void 0:s.username)||"").toLowerCase(),d=i.startsWith(e),c=o.startsWith(e);return d&&!c?-1:!d&&c?1:i.localeCompare(o)}),Y(a),W(!0),V(t.lastIndexOf("@")),ee(0),U(!1)}else W(!1),X("")},[eg,ed]),eE=(0,a.useCallback)(e=>{let t=S.substring(0,O);E(t+e+" "+S.substring(S.lastIndexOf("#")+1)),U(!1)},[S,O]),eA=e=>{if("direct"===e.type){var t,a,r;let l=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==eo?void 0:eo.id));return(null==l||null==(a=l.user_profile)?void 0:a.full_name)||(null==l||null==(r=l.user_profile)?void 0:r.username)||"Unknown User"}return e.name||"Group Chat"},eT=e=>{if("direct"===e.type){var t,a;let r=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==eo?void 0:eo.id));return null==r||null==(a=r.user_profile)?void 0:a.avatar_url}return null},eI=(0,a.useMemo)(()=>et.filter(e=>{var t,a;if(!A)return!0;let r=eA(e).toLowerCase(),l=(null==(a=e.last_message)||null==(t=a.content)?void 0:t.toLowerCase())||"";return r.includes(A.toLowerCase())||l.includes(A.toLowerCase())}),[et,A]),eL=(0,a.useMemo)(()=>et.reduce((e,t)=>e+(t.unread_count||0),0),[et]),eR=(0,a.useCallback)(()=>{if(eu.current){let e=eu.current,t=e.scrollHeight-e.clientHeight;t-e.scrollTop<100?e.scrollTo({top:t,behavior:"smooth"}):e.scrollTop=t,L(!1)}},[]);return(0,a.useEffect)(()=>{if(em.length>0){let e=()=>{eu.current&&(eu.current.scrollTop=eu.current.scrollHeight)};e(),requestAnimationFrame(()=>{e()}),setTimeout(()=>{e()},50)}},[em.length,_,em]),(0,t.jsxs)("div",{className:"flex h-full relative bg-gray-50 dark:bg-gray-900",children:[ex&&(0,t.jsx)("div",{className:"absolute inset-0 bg-white/80 dark:bg-gray-900/80 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading messages..."})]})}),(0,t.jsxs)("div",{className:"\n        ".concat(_?"hidden lg:flex":"flex","\n        w-full lg:w-80 xl:w-96 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-col\n        absolute lg:relative h-full z-30\n      "),children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("div",{className:"flex items-center flex-1",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[(0,t.jsx)("span",{className:"bg-gradient-to-r from-primary-500 to-accent-500 bg-clip-text text-transparent text-2xl lg:text-xl",children:"Moreno"}),(0,t.jsx)("span",{className:"hidden lg:inline text-gray-400 mx-2",children:"•"}),(0,t.jsx)("span",{className:"hidden lg:inline text-gray-900 dark:text-white",children:"Messages"})]}),(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 lg:hidden",children:"Messages"})]})}),eL>0&&(0,t.jsxs)("span",{className:"text-sm font-bold text-primary-700 dark:text-primary-400 bg-primary-100 dark:bg-primary-900/20 px-3 py-1.5 rounded-full border border-primary-200 dark:border-primary-800",children:[eL," new"]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(i.MagnifyingGlassIcon,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500 dark:text-gray-400"}),(0,t.jsx)("input",{type:"text",placeholder:"Search messages...",value:A,onChange:e=>T(e.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:bg-white dark:focus:bg-gray-600 transition-all font-medium text-gray-900 dark:text-white"})]})]}),(0,t.jsx)("div",{className:"overflow-y-auto flex-1 bg-gray-50 dark:bg-gray-900",children:0===eI.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8",children:[(0,t.jsx)(c.UserGroupIcon,{className:"w-16 h-16 text-gray-400 dark:text-gray-600 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-black mb-2",children:"No conversations yet"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-center",children:"Start a conversation with your friends to see messages here"})]}):eI.map(e=>(0,t.jsx)(p,{chat:e,user:eo,isSelected:_===e.id,onSelect:eN,onlineFriends:en},e.id))})]}),_?(0,t.jsxs)("div",{className:"\n          flex-1 flex flex-col bg-white dark:bg-gray-800 relative\n          ".concat(_?"flex":"hidden lg:flex","\n          absolute lg:relative w-full h-full z-30\n        "),children:[(0,t.jsxs)("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b-2 border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center flex-1",children:[(0,t.jsx)("button",{onClick:()=>{C(null),ea(null)},className:"lg:hidden mr-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(o,{className:"w-5 h-5 text-gray-700 dark:text-gray-300 font-bold"})}),(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[eT(eb)?(0,t.jsx)("img",{src:eT(eb),alt:eA(eb),className:"w-11 h-11 rounded-full object-cover shadow-md"}):(0,t.jsx)("div",{className:"w-11 h-11 bg-gradient-to-br from-primary-500 to-accent-500 rounded-full flex items-center justify-center text-white font-bold text-base shadow-md",children:(e=>{var t,a,r,l,n,s;if("direct"===e.type){let t=null==(a=e.participants)?void 0:a.find(e=>e.user_id!==(null==eo?void 0:eo.id));return(null==t||null==(l=t.user_profile)||null==(r=l.full_name)?void 0:r[0])||(null==t||null==(s=t.user_profile)||null==(n=s.username)?void 0:n[0])||"?"}return(null==(t=e.name)?void 0:t[0])||"G"})(eb)}),(e=>{if("direct"===e.type){var t;let a=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==eo?void 0:eo.id));return a&&en.includes(a.user_id)}return!1})(eb)&&(0,t.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-green-500 rounded-full border-2 border-white dark:border-gray-800 shadow-sm"})]}),(0,t.jsxs)("div",{className:"ml-3 min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("h3",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-white truncate",children:eA(eb)}),(null==eb?void 0:eb.type)==="direct"&&(()=>{var e,a,r;let l=null==(e=eb.participants)?void 0:e.find(e=>e.user_id!==(null==eo?void 0:eo.id)),n=(e=>{if(!e)return"";let t=y.countries.find(t=>t.name===e);return console.log("🔍 Debug flag lookup:",{countryName:e,found:!!t,flag:null==t?void 0:t.flag}),(null==t?void 0:t.flag)||""})((null==l||null==(a=l.user_profile)?void 0:a.location)||void 0);return n?(0,t.jsx)("span",{className:"text-lg",title:(null==l||null==(r=l.user_profile)?void 0:r.location)||void 0,children:n}):null})()]}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsx)(f.StatusIndicator,{userId:(null==eb||null==(b=eb.participants)||null==(e=b.find(e=>e.user_id!==(null==eo?void 0:eo.id)))?void 0:e.user_id)||"",size:"sm",showText:!0})})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[(0,t.jsx)("button",{className:"p-2 sm:p-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(l.PhoneIcon,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-700 dark:text-gray-300"})}),(0,t.jsx)("button",{className:"p-2 sm:p-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(n,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-700 dark:text-gray-300"})}),(0,t.jsx)("button",{className:"hidden sm:block p-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(i.MagnifyingGlassIcon,{className:"w-6 h-6 text-gray-700 dark:text-gray-300"})}),(0,t.jsx)("button",{className:"p-2 sm:p-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(s,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-700 dark:text-gray-300"})})]})]}),(0,t.jsxs)("div",{ref:eu,onScroll:()=>{if(eu.current){let{scrollTop:e,scrollHeight:t,clientHeight:a}=eu.current;L(!(t-e-a<100))}},className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4 pb-24 bg-gradient-to-b from-gray-50 to-white dark:from-gray-900 dark:to-gray-800 relative",children:[ex?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):eh?(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-red-600 dark:text-red-400",children:eh})}):0===em.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,t.jsx)(d.ChatBubbleLeftRightIcon,{className:"w-16 h-16 text-gray-400 dark:text-gray-600 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-black mb-2",children:"No messages yet"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-center",children:"Start the conversation by sending a message"})]}):(0,t.jsxs)("div",{className:"space-y-4 max-w-4xl mx-auto",children:[em.map(e=>{var a,r;let l=e.sender_id===(null==eo?void 0:eo.id),n=null==eb||null==(r=eb.participants)||null==(a=r.find(e=>e.user_id!==(null==eo?void 0:eo.id)))?void 0:a.user_profile;return(0,t.jsx)(F,{message:e,isOwnMessage:l,user:eo,otherUserProfile:n,onReply:ew,onEdit:ej},e.id)}),(console.log("🔍 Typing Debug:",{selectedChatId:_,typingIndicators:es,hasTypingForChat:_?es[_]:null,typingCount:_&&es[_]?es[_].length:0}),_&&es[_]&&es[_].length>0?(0,t.jsx)(K,{typingUsers:es[_].map(e=>e.user_profile||{id:e.user_id,full_name:null,username:null,avatar_url:null}),className:"mb-2"}):null),(0,t.jsx)("div",{ref:ec,"data-messages-end":!0})]}),I&&(0,t.jsx)("button",{onClick:eR,className:"fixed bottom-20 right-6 z-40 bg-primary-600 hover:bg-primary-700 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-105","aria-label":"Scroll to bottom",children:(0,t.jsx)(u.ChevronDownIcon,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 px-3 sm:px-4 py-3 sm:py-4 border-t-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-lg z-30",children:[(z||G)&&(0,t.jsxs)("div",{className:"mb-3 px-4 py-2 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(G?"bg-yellow-500":"bg-blue-500")}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:G?"Editing message":"Replying to"}),(0,t.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:(null==z||null==(v=z.sender_profile)?void 0:v.full_name)||(null==z||null==(w=z.sender_profile)?void 0:w.username)||"Unknown"})]}),(0,t.jsx)("button",{onClick:ek,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(z||G)&&(0,t.jsx)("div",{className:"mt-2 p-2 bg-white dark:bg-gray-600 rounded border border-gray-200 dark:border-gray-500",children:(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 truncate",children:null==(j=z||G)?void 0:j.content})})]}),(0,t.jsx)("div",{className:"flex items-center justify-center max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl relative",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3 bg-gray-100 dark:bg-gray-700 rounded-full px-4 py-2 border border-gray-300 dark:border-gray-600 focus-within:ring-2 focus-within:ring-primary-500 focus-within:bg-white dark:focus-within:bg-gray-600 focus-within:border-primary-500 transition-all",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-2 border-gray-300 dark:border-gray-600 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:(0,t.jsx)("span",{className:"text-black font-semibold text-sm",children:(null==eo||null==(N=eo.email)||null==(k=N[0])?void 0:k.toUpperCase())||"U"})}),(0,t.jsx)("input",{type:"text",value:S,onChange:eS,onKeyPress:eC,placeholder:"Type a message...",disabled:ep,className:"flex-1 bg-transparent border-none outline-none text-sm sm:text-base font-medium text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 disabled:opacity-50"}),(0,t.jsx)("button",{onClick:ev,disabled:ep||!S.trim(),className:"w-8 h-8 bg-blue-700 text-white rounded-full flex items-center justify-center transition-all duration-200 hover:scale-105 flex-shrink-0 ".concat(S.trim()?"bg-primary-400 hover:bg-primary-700 text-black cursor-pointer":"bg-gray-700 text-white dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"," ").concat(ep?"opacity-50 cursor-not-allowed":""),children:ep?(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-t-transparent rounded-full animate-spin ".concat(S.trim()?"border-white":"border-gray-500 dark:border-gray-400")}):(0,t.jsx)(r,{className:"w-4 h-4"})})]}),P&&R.length>0&&(0,t.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50 p-3",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:R.map((e,a)=>(0,t.jsx)("button",{onClick:()=>eE(e),className:"text-2xl hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg p-2 transition-colors",title:"Insert ".concat(e),children:e},a))})}),Z&&q.length>0&&(0,t.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50 p-3 max-h-60 overflow-y-auto",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("div",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:$?'Friends matching "'.concat($,'"'):"Share a friend:"}),(0,t.jsxs)("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:[q.length," ",1===q.length?"friend":"friends"]})]}),0===q.length&&$?(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:['No friends found matching "',$,'"']}),(0,t.jsx)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Try a different name or username"})]}):q.map((e,a)=>{var r,l,n,s,i,o,d;return(0,t.jsxs)("button",{onClick:()=>e_(e),className:"flex items-center space-x-3 w-full p-2 rounded-lg transition-colors ".concat(a===Q?"bg-primary-100 dark:bg-primary-900/20 border border-primary-300 dark:border-primary-700":"hover:bg-gray-100 dark:hover:bg-gray-700"),children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:(null==(r=e.friend_profile)?void 0:r.avatar_url)?(0,t.jsx)("img",{src:e.friend_profile.avatar_url,alt:e.friend_profile.full_name||"Friend",className:"w-8 h-8 rounded-full object-cover"}):(0,t.jsx)("span",{children:((null==(l=e.friend_profile)?void 0:l.full_name)||(null==(n=e.friend_profile)?void 0:n.username)||"F")[0].toUpperCase()})}),(0,t.jsxs)("div",{className:"flex-1 text-left min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:(null==(s=e.friend_profile)?void 0:s.full_name)||(null==(i=e.friend_profile)?void 0:i.username)||"Unknown Friend"}),(null==(o=e.friend_profile)?void 0:o.username)&&(null==(d=e.friend_profile)?void 0:d.full_name)&&(0,t.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:["@",e.friend_profile.username]})]})]},e.id)}),!$&&(0,t.jsx)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:"💡 Tip: Type @friends/name to filter friends"})]})})]})})]})]}):(0,t.jsx)("div",{className:"hidden lg:flex flex-1 items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-28 h-28 mx-auto mb-4 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center shadow-md",children:(0,t.jsx)(d.ChatBubbleLeftRightIcon,{className:"w-14 h-14 text-gray-500 dark:text-gray-400"})}),(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Select a conversation"}),(0,t.jsx)("p",{className:"text-base font-medium text-gray-600 dark:text-gray-400",children:"Choose a chat from the list to start messaging"})]})})]})}}]);