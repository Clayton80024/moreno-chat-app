(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52071,e=>{"use strict";e.s(["default",()=>K],52071);var t=e.i(43476),r=e.i(71645);let a=r.forwardRef(function(e,t){let{title:a,titleId:l,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),a?r.createElement("title",{id:l},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"}))});var l=e.i(75272);let n=r.forwardRef(function(e,t){let{title:a,titleId:l,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),a?r.createElement("title",{id:l},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"}))}),s=r.forwardRef(function(e,t){let{title:a,titleId:l,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),a?r.createElement("title",{id:l},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"}))});var i=e.i(39875);let o=r.forwardRef(function(e,t){let{title:a,titleId:l,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),a?r.createElement("title",{id:l},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))});var d=e.i(47604),c=e.i(33576),u=e.i(44735),g=e.i(55344),m=e.i(83642),x=e.i(70011),h=e.i(37163),f=e.i(50057),y=e.i(24166);let p=r.default.memo(e=>{var r;let{chat:a,user:l,isSelected:n,onSelect:s,onlineFriends:i}=e,o=(e=>{if("direct"===e.type){var t,r,a;let n=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==l?void 0:l.id));return(null==n||null==(r=n.user_profile)?void 0:r.full_name)||(null==n||null==(a=n.user_profile)?void 0:a.username)||"Unknown User"}return e.name||"Group Chat"})(a),d=(e=>{if("direct"===e.type){var t,r;let a=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==l?void 0:l.id));return null==a||null==(r=a.user_profile)?void 0:r.avatar_url}return null})(a),c=(e=>{var t,r,a,n,s,i;if("direct"===e.type){let t=null==(r=e.participants)?void 0:r.find(e=>e.user_id!==(null==l?void 0:l.id));return(null==t||null==(n=t.user_profile)||null==(a=n.full_name)?void 0:a[0])||(null==t||null==(i=t.user_profile)||null==(s=i.username)?void 0:s[0])||"?"}return(null==(t=e.name)?void 0:t[0])||"G"})(a),u=(e=>{if("direct"===e.type){var t;let r=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==l?void 0:l.id));return r&&i.includes(r.user_id)}return!1})(a),g=a.last_message_at?new Date(a.last_message_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return(0,t.jsxs)("div",{onClick:()=>s(a.id),className:"\n        flex items-center px-4 py-3.5 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-colors border-b border-gray-100 dark:border-gray-800\n        ".concat(n?"bg-primary-50 dark:bg-primary-900/20 lg:border-l-4 lg:border-primary-600":"","\n      "),children:[(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[d?(0,t.jsx)("img",{src:d,alt:o,className:"w-12 h-12 rounded-full object-cover shadow-md"}):(0,t.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-primary-500 to-accent-500 rounded-full flex items-center justify-center text-white font-bold text-base shadow-md",children:c}),u&&(0,t.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 rounded-full border-2 border-white dark:border-gray-800 shadow-sm"})]}),(0,t.jsxs)("div",{className:"ml-3 flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("p",{className:"text-base font-bold text-gray-900 dark:text-white truncate",children:o}),"direct"===a.type&&(()=>{var e,r,n;let s=null==(e=a.participants)?void 0:e.find(e=>e.user_id!==(null==l?void 0:l.id)),i=(e=>{if(!e)return"";let t=y.countries.find(t=>t.name===e);return(null==t?void 0:t.flag)||""})((null==s||null==(r=s.user_profile)?void 0:r.location)||void 0);return i?(0,t.jsx)("span",{className:"text-lg",title:(null==s||null==(n=s.user_profile)?void 0:n.location)||void 0,children:i}):null})()]}),(0,t.jsx)("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 ml-2 flex-shrink-0",children:g})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center mt-0.5",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate pr-2",children:(null==(r=a.last_message)?void 0:r.content)||"No messages yet"}),a.unread_count&&a.unread_count>0&&(0,t.jsx)("span",{className:"ml-auto bg-primary-600 text-white text-xs font-bold rounded-full px-2 py-0.5 flex-shrink-0 shadow-sm min-w-[20px] text-center",children:a.unread_count})]})]})]})});p.displayName="ChatItem";var b=e.i(27217),v=e.i(62060);let w=r.forwardRef(function(e,t){let{title:a,titleId:l,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),a?r.createElement("title",{id:l},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M22 10.5h-6m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM4 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 10.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))});var j=e.i(65300);function k(e){let{isOpen:a,onClose:l,friendProfile:n}=e,{user:s}=(0,m.useAuth)(),{friends:i}=(0,h.useFriends)(),[o,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)("none"),g=null==i?void 0:i.some(e=>{var t;return(null==(t=e.friend_profile)?void 0:t.id)===n.id});r.default.useEffect(()=>{s&&n.id&&j.FriendsService.getFriendRequestStatus(s.id,n.id).then(e=>{u(e.status)}).catch(e=>{console.error("Error checking friend status:",e)})},[s,n.id]);let x=async()=>{if(s&&!o){d(!0);try{await j.FriendsService.sendFriendRequest(s.id,n.id,"Hi! I saw you mentioned in a chat and wanted to connect."),u("pending_sent")}catch(e){console.error("Error sending friend request:",e)}finally{d(!1)}}},f=async()=>{if(s&&!o){d(!0);try{u("accepted")}catch(e){console.error("Error accepting friend request:",e)}finally{d(!1)}}};return a?(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Friend Profile"}),(0,t.jsx)("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,t.jsx)(b.XMarkIcon,{className:"w-6 h-6"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center text-white font-bold text-2xl shadow-lg",children:n.avatar_url?(0,t.jsx)("img",{src:n.avatar_url,alt:n.full_name||"Friend",className:"w-20 h-20 rounded-full object-cover"}):(0,t.jsx)("span",{children:(n.full_name||n.username||"F")[0].toUpperCase()})}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-1",children:n.full_name||n.username||"Unknown User"}),n.username&&n.full_name&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["@",n.username]}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(n.is_online?"bg-green-500":"bg-gray-400")}),(0,t.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:n.is_online?"Online":"Offline"})]}),(0,t.jsx)("div",{className:"text-sm font-medium ".concat((()=>{switch(c){case"accepted":return"text-green-600 dark:text-green-400";case"pending_sent":return"text-yellow-600 dark:text-yellow-400";case"pending_received":return"text-blue-600 dark:text-blue-400";case"declined":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}})()),children:(()=>{switch(c){case"accepted":return"You are friends";case"pending_sent":return"Friend request sent";case"pending_received":return"Wants to be friends";case"declined":return"Friend request declined";default:return"Not friends yet"}})()})]}),n.bio&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Bio"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:n.bio})]}),n.location&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Location"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:n.location})]}),(0,t.jsx)("div",{className:"pt-4",children:(()=>{if(g)return(0,t.jsxs)("button",{disabled:!0,className:"w-full px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-500 dark:text-gray-400 rounded-lg cursor-not-allowed flex items-center justify-center space-x-2",children:[(0,t.jsx)(w,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:"Already Friends"})]});switch(c){case"pending_sent":return(0,t.jsxs)("button",{disabled:!0,className:"w-full px-4 py-2 bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300 rounded-lg cursor-not-allowed flex items-center justify-center space-x-2",children:[(0,t.jsx)(v.UserPlusIcon,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:"Request Sent"})]});case"pending_received":return(0,t.jsxs)("button",{onClick:f,disabled:o,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center space-x-2 disabled:opacity-50",children:[(0,t.jsx)(v.UserPlusIcon,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:o?"Accepting...":"Accept Request"})]});case"declined":return(0,t.jsxs)("button",{onClick:x,disabled:o,className:"w-full px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg flex items-center justify-center space-x-2 disabled:opacity-50",children:[(0,t.jsx)(v.UserPlusIcon,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:o?"Sending...":"Send Request Again"})]});default:return(0,t.jsxs)("button",{onClick:x,disabled:o,className:"w-full px-4 py-2 bg-primary-600 hover:bg-primary-700 text-black rounded-lg flex items-center justify-center space-x-2 disabled:opacity-50",children:[(0,t.jsx)(v.UserPlusIcon,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:o?"Sending...":"Send Friend Request"})]})}})()})]})]})}):null}var N=e.i(17927);e.i(47167);var _=e.i(99749);class C{static async translate(e,t,r,a){try{var l,n,s,i,o,d;if(!e||!e.trim())throw Error("Text to translate cannot be empty");if(!t)throw Error("Target language is required");let c=C.getCacheKey(e,t,r),u=C.getCachedTranslation(c);if(u)return console.log("🌐 Translation served from cache"),u;if(!C.API_KEY)return console.warn("⚠️ Google Translate API key not configured"),console.log("🔍 API Key Debug:",{hasKey:!!C.API_KEY,keyLength:(null==(i=C.API_KEY)?void 0:i.length)||0,keyStart:(null==(o=C.API_KEY)?void 0:o.substring(0,10))||"none"}),e;let g={q:e,target:t,format:"text",...r&&{source:r}};console.log("🌐 Translating text:",{text:e.substring(0,50)+"...",targetLanguage:t});let m=await fetch("".concat(C.API_URL,"?key=").concat(C.API_KEY),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g),signal:a});if(!m.ok){let e=await m.json().catch(()=>({}));throw Error("Translation API error: ".concat(m.status," - ").concat((null==(d=e.error)?void 0:d.message)||"Unknown error"))}let x=await m.json();if(!(null==(s=x.data)||null==(n=s.translations)||null==(l=n[0])?void 0:l.translatedText))throw Error("Invalid translation response");let h=x.data.translations[0].translatedText;return C.cacheTranslation(c,h),console.log("✅ Translation successful:",h.substring(0,50)+"..."),h}catch(t){return console.error("🔴 Translation error:",t),e}}async translateBatch(e,t,r){try{let a=e.map(e=>C.translate(e,t,r));return await Promise.all(a)}catch(t){return console.error("🔴 Batch translation error:",t),e}}async detectLanguage(e){try{var t,r,a,l;if(!C.API_KEY)return"en";let n=await fetch("".concat(C.API_URL,"/detect?key=").concat(C.API_KEY),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:e})});if(!n.ok)throw Error("Language detection API error: ".concat(n.status));return(null==(l=(await n.json()).data)||null==(a=l.detections)||null==(r=a[0])||null==(t=r[0])?void 0:t.language)||"en"}catch(e){return console.error("🔴 Language detection error:",e),"en"}}static getCachedTranslation(e){let t=C.cache[e];return t&&Date.now()<t.expiresAt?t.translation:(t&&delete C.cache[e],null)}static cacheTranslation(e,t){if(Object.keys(C.cache).length>=C.MAX_CACHE_SIZE&&(C.cleanExpiredCache(),Object.keys(C.cache).length>=C.MAX_CACHE_SIZE)){let e=Object.entries(C.cache);e.sort((e,t)=>e[1].timestamp-t[1].timestamp);let t=Math.floor(.2*e.length);for(let r=0;r<t;r++)delete C.cache[e[r][0]]}C.cache[e]={translation:t,timestamp:Date.now(),expiresAt:Date.now()+C.CACHE_DURATION}}static getCacheKey(e,t,r){return"".concat(e.toLowerCase(),"_").concat(t,"_").concat(r||"auto")}static cleanExpiredCache(){let e=Date.now();Object.keys(C.cache).forEach(t=>{C.cache[t].expiresAt<e&&delete C.cache[t]})}static getCacheStats(){return{size:Object.keys(C.cache).length,entries:Object.keys(C.cache)}}static clearCache(){C.cache={}}}(0,_._)(C,"cache",{}),(0,_._)(C,"CACHE_DURATION",864e5),(0,_._)(C,"MAX_CACHE_SIZE",1e3),(0,_._)(C,"API_KEY","AIzaSyA_BvHV9rf3SS-2MKWIL-f8bYfp1nGpm0g"),(0,_._)(C,"API_URL","https://translation.googleapis.com/language/translate/v2");let S={translate:/^#translate\s+"([^"]+)"\s+to\s+(\w+)$/i,translateShort:/^#t\s+"([^"]+)"\s+to\s+(\w+)$/i,help:/^#help$/i},E={english:"en",spanish:"es",portuguese:"pt",french:"fr",german:"de",italian:"it",chinese:"zh",japanese:"ja",korean:"ko",arabic:"ar",hindi:"hi",russian:"ru",dutch:"nl",polish:"pl",thai:"th",vietnamese:"vi"};class A{static parseCommand(e){let t=e.trim();for(let[e,r]of Object.entries(S)){let a=t.match(r);if(a)switch(e){case"translate":case"translateShort":return{type:"translate",text:a[1],targetLanguage:this.normalizeLanguage(a[2])};case"help":return{type:"help"}}}return null}static isCommand(e){return null!==this.parseCommand(e)}static normalizeLanguage(e){let t=e.toLowerCase();return E[t]||t}static getHelpText(){return'\n🌐 Translation Commands:\n\n#translate "text" to language\n#t "text" to language\n  • Translate specific text to a language\n  • Example: #translate "Hello" to Spanish\n\n#help\n  • Show this help message\n\nSupported languages: English, Spanish, Portuguese, French, German, Italian, Chinese, Japanese, Korean, Arabic, Hindi, Russian, Dutch, Polish, Thai, Vietnamese\n    '.trim()}}class T{static getSettings(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e)return JSON.parse(e)}catch(e){console.error("Error loading translation settings:",e)}return{}}static updateSettings(e){try{let t={...this.getSettings(),...e};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(e){console.error("Error saving translation settings:",e)}}static resetSettings(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(e){console.error("Error resetting translation settings:",e)}}}(0,_._)(T,"STORAGE_KEY","translation_settings");class I{static shouldTranslate(e,t,r,a){return A.isCommand(e),!1}static needsTranslation(e,t){return this.getLanguageFromCountry(e)!==this.getLanguageFromCountry(t)}static getLanguageFromCountry(e){return({Canada:"en","United States":"en",Mexico:"es",Brazil:"pt",Argentina:"es",Chile:"es",Colombia:"es",Peru:"es",Venezuela:"es",France:"fr",Germany:"de",Italy:"it",Spain:"es","United Kingdom":"en",Netherlands:"nl",Poland:"pl",Russia:"ru",China:"zh",Japan:"ja","South Korea":"ko",India:"hi",Thailand:"th",Vietnam:"vi","Saudi Arabia":"ar",Egypt:"ar","South Africa":"en",Nigeria:"en",Australia:"en","New Zealand":"en"})[e]||"en"}}let L=[{country:"Canada",language:"English",languageCode:"en",flag:"🇨🇦"},{country:"United States",language:"English",languageCode:"en",flag:"🇺🇸"},{country:"Mexico",language:"Spanish",languageCode:"es",flag:"🇲🇽"},{country:"Brazil",language:"Portuguese",languageCode:"pt",flag:"🇧🇷"},{country:"Argentina",language:"Spanish",languageCode:"es",flag:"🇦🇷"},{country:"Chile",language:"Spanish",languageCode:"es",flag:"🇨🇱"},{country:"Colombia",language:"Spanish",languageCode:"es",flag:"🇨🇴"},{country:"Peru",language:"Spanish",languageCode:"es",flag:"🇵🇪"},{country:"Venezuela",language:"Spanish",languageCode:"es",flag:"🇻🇪"},{country:"France",language:"French",languageCode:"fr",flag:"🇫🇷"},{country:"Germany",language:"German",languageCode:"de",flag:"🇩🇪"},{country:"Italy",language:"Italian",languageCode:"it",flag:"🇮🇹"},{country:"Spain",language:"Spanish",languageCode:"es",flag:"🇪🇸"},{country:"United Kingdom",language:"English",languageCode:"en",flag:"🇬🇧"},{country:"Netherlands",language:"Dutch",languageCode:"nl",flag:"🇳🇱"},{country:"Poland",language:"Polish",languageCode:"pl",flag:"🇵🇱"},{country:"Russia",language:"Russian",languageCode:"ru",flag:"🇷🇺"},{country:"China",language:"Chinese",languageCode:"zh",flag:"🇨🇳"},{country:"Japan",language:"Japanese",languageCode:"ja",flag:"🇯🇵"},{country:"South Korea",language:"Korean",languageCode:"ko",flag:"🇰🇷"},{country:"India",language:"Hindi",languageCode:"hi",flag:"🇮🇳"},{country:"Thailand",language:"Thai",languageCode:"th",flag:"🇹🇭"},{country:"Vietnam",language:"Vietnamese",languageCode:"vi",flag:"🇻🇳"},{country:"Saudi Arabia",language:"Arabic",languageCode:"ar",flag:"🇸🇦"},{country:"Egypt",language:"Arabic",languageCode:"ar",flag:"🇪🇬"},{country:"South Africa",language:"English",languageCode:"en",flag:"🇿🇦"},{country:"Nigeria",language:"English",languageCode:"en",flag:"🇳🇬"},{country:"Australia",language:"English",languageCode:"en",flag:"🇦🇺"},{country:"New Zealand",language:"English",languageCode:"en",flag:"🇳🇿"}];function R(e){let t=L.find(t=>t.country.toLowerCase()===e.toLowerCase());return(null==t?void 0:t.languageCode)||"en"}function M(e){return L.find(t=>t.country.toLowerCase()===e.toLowerCase())||null}let P=r.forwardRef(function(e,t){let{title:a,titleId:l,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),a?r.createElement("title",{id:l},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"}))});var O=e.i(79259);let U=(e,r,a)=>e.split(/@(\w+)/g).map((e,l)=>l%2==1?(0,t.jsxs)("button",{onClick:()=>a(e),className:"font-medium cursor-pointer hover:opacity-80 transition-opacity ".concat(r?"text-primary-100 bg-primary-500/20 px-1 rounded":"text-primary-600 bg-primary-100 dark:bg-primary-900/20 px-1 rounded"),children:["@",e]},l):e),F=r.default.memo(e=>{var a,l;let{message:n,isOwnMessage:s,user:i,otherUserProfile:o,onReply:d,onEdit:c}=e,{profile:u}=(0,m.useAuth)(),g=n.sender_profile,x=new Date(n.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),[h,f]=(0,r.useState)(!1),[p,b]=(0,r.useState)(null),v=(null==g?void 0:g.location)||"",w=s?(null==o?void 0:o.location)||"":(null==u?void 0:u.location)||"",{translation:j,isLoading:_,error:S,isCommand:E,commandResult:L}=function(e,t){let{enabled:a=!0,senderCountry:l,receiverCountry:n}=t,[s,i]=(0,r.useState)(""),[o,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(null),[g,m]=(0,r.useState)(),x=(0,r.useRef)(null),h=T.getSettings(),f=A.isCommand(e),y=(0,r.useCallback)(async e=>{let t=A.parseCommand(e);if(t)switch(t.type){case"translate":if(t.text&&t.targetLanguage){d(!0),u(null);try{let e=await C.translate(t.text,t.targetLanguage);m('🌐 Translation: "'.concat(e,'"'))}catch(e){u(e.message||"Failed to translate"),m("❌ Translation failed: ".concat(e.message))}finally{d(!1)}}break;case"help":m(A.getHelpText())}},[]),p=(0,r.useCallback)(async()=>{if(!a||!(null==e?void 0:e.trim())||f||!I.shouldTranslate(e,l,n,h)){i(""),d(!1),u(null);return}d(!0),u(null),i(""),x.current&&x.current.abort(),x.current=new AbortController;let t=x.current.signal;try{let r=R(l),a=R(n);if(!r||!a)throw Error("Could not determine sender or receiver language from country.");let s=await C.translate(e,a,r,t);i(s)}catch(t){if("AbortError"===t.name)return;console.error("🔴 Translation hook error:",t),u(t.message||"Failed to translate message."),i(e)}finally{d(!1)}},[e,l,n,a,f,h]);return(0,r.useEffect)(()=>{f?y(e):m(void 0)},[f,e,y]),(0,r.useEffect)(()=>{f||p()},[f,p]),(0,r.useEffect)(()=>()=>{x.current&&x.current.abort()},[]),{translation:s,isLoading:o,error:c,isCommand:f,commandResult:g}}(n.content,{enabled:!0,senderCountry:v,receiverCountry:w}),F=M(v);M(w);let K=async e=>{try{let{data:t,error:r}=await N.supabase.from("user_profiles").select("id, full_name, username, avatar_url, bio, location, is_online, last_seen").or("username.ilike.%".concat(e,"%,full_name.ilike.%").concat(e,"%")).limit(1);if(r)return void console.error("Error searching for user:",r);t&&t.length>0?(b(t[0]),f(!0)):console.log("User not found:",e)}catch(e){console.error("Error handling mention click:",e)}};return(0,t.jsxs)("div",{className:"flex ".concat(s?"justify-end":"justify-start"),children:[(0,t.jsxs)("div",{className:"group max-w-[75%] sm:max-w-xs lg:max-w-md px-4 py-3 rounded-2xl shadow-md\n        ".concat(s?"bg-primary-600 text-black ml-12":"bg-white dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 text-gray-900 dark:text-white mr-12","\n      "),children:[!s&&g&&(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-1 ".concat(s?"text-primary-50":"text-gray-800 dark:text-gray-200"),children:[(0,t.jsx)("p",{className:"text-xs font-bold",children:g.full_name||g.username||"Unknown User"}),(()=>{let e=(e=>{if(!e)return"";let t=y.countries.find(t=>t.name===e);return(null==t?void 0:t.flag)||""})(g.location||void 0);return e?(0,t.jsx)("span",{className:"text-sm",title:g.location||void 0,children:e}):null})()]}),n.reply_to_id&&n.reply_to_message&&(0,t.jsxs)("div",{className:"mb-2 p-2 rounded-lg border-l-4 ".concat(s?"bg-primary-500/10 border-primary-500":"bg-gray-100 dark:bg-gray-600 border-gray-400"),children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,t.jsx)(P,{className:"w-3 h-3 ".concat(s?"text-primary-400":"text-gray-500")}),(0,t.jsxs)("span",{className:"text-xs font-medium ".concat(s?"text-primary-300":"text-gray-600 dark:text-gray-400"),children:["Replying to ",(null==(a=n.reply_to_message.sender_profile)?void 0:a.full_name)||(null==(l=n.reply_to_message.sender_profile)?void 0:l.username)||"Unknown"]})]}),(0,t.jsx)("p",{className:"text-xs truncate ".concat(s?"text-primary-200":"text-gray-700 dark:text-gray-300"),children:n.reply_to_message.content})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[E&&L&&(0,t.jsx)("div",{className:"rounded-lg p-3 border-l-4 border-blue-500 ".concat(s?"bg-blue-500/10":"bg-blue-50 dark:bg-blue-900/20"),children:(0,t.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,t.jsx)("span",{className:"text-blue-500 text-lg",children:"⚡"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium ".concat(s?"text-blue-100":"text-blue-800 dark:text-blue-200"),children:"Command Result:"}),(0,t.jsx)("pre",{className:"text-xs mt-1 whitespace-pre-wrap break-words ".concat(s?"text-blue-200":"text-blue-700 dark:text-blue-300"),children:L})]})]})}),(0,t.jsx)("p",{className:"text-sm sm:text-base leading-relaxed break-words font-medium ".concat(s?"text-black":"text-gray-900 dark:text-gray-100"),children:U(n.content,s,K)}),!E&&j&&j!==n.content&&(0,t.jsxs)("div",{className:"relative",children:[_&&(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-500 dark:text-gray-400",children:[(0,t.jsx)("div",{className:"w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("span",{children:"Translating..."})]}),j&&!_&&(0,t.jsxs)("div",{className:"rounded-lg p-2 border-l-2 border-primary-500 ".concat(s?"bg-primary-500/10":"bg-gray-50 dark:bg-gray-600"),children:[(0,t.jsx)("p",{className:"text-sm leading-relaxed break-words ".concat(s?"text-primary-100":"text-gray-800 dark:text-gray-200"),children:U(j,s,K)}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,t.jsxs)("span",{className:"text-xs flex items-center space-x-1 ".concat(s?"text-primary-200":"text-gray-500 dark:text-gray-400"),children:[(0,t.jsx)("span",{children:"🌐"}),(0,t.jsxs)("span",{children:["Translated from ",(null==F?void 0:F.language)||"Unknown"]})]}),S&&(0,t.jsx)("span",{className:"text-xs text-red-500",title:S,children:"⚠️"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-1.5",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("p",{className:"\n              text-xs text-black font-semibold\n              ".concat(s?"text-primary-100":"text-gray-600 dark:text-gray-400","\n            "),children:x}),n.edited_at&&(0,t.jsx)("span",{className:"text-xs ".concat(s?"text-primary-200":"text-gray-500 dark:text-gray-500"),children:"(edited)"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,t.jsx)("button",{onClick:()=>null==d?void 0:d(n),className:"p-1 rounded-full hover:bg-opacity-20 transition-colors ".concat(s?"hover:bg-primary-200 text-primary-200":"hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-500 dark:text-gray-400"),title:"Reply to message",children:(0,t.jsx)(P,{className:"w-4 h-4"})}),s&&(0,t.jsx)("button",{onClick:()=>null==c?void 0:c(n),className:"p-1 rounded-full hover:bg-primary-200 hover:bg-opacity-20 text-primary-200 transition-colors",title:"Edit message",children:(0,t.jsx)(O.PencilIcon,{className:"w-4 h-4"})})]})]})]}),p&&(0,t.jsx)(k,{isOpen:h,onClose:()=>{f(!1),b(null)},friendProfile:p})]})});function K(){var e,b,v,w,j,k,N;let[_,C]=(0,r.useState)(null),[S,E]=(0,r.useState)(""),[A,T]=(0,r.useState)(""),[I,L]=(0,r.useState)(!1),[R,M]=(0,r.useState)([]),[P,O]=(0,r.useState)(!1),[U,K]=(0,r.useState)(0),[z,B]=(0,r.useState)(null),[D,G]=(0,r.useState)(null),[H,q]=(0,r.useState)([]),[Y,Z]=(0,r.useState)(!1),[W,J]=(0,r.useState)(0),[V,$]=(0,r.useState)(""),[X,Q]=(0,r.useState)(0),{chats:ee,setCurrentChat:et,sendMessage:er,markMessagesAsRead:ea,onlineFriends:el}=(0,g.useRealtime)(),{user:en}=(0,m.useAuth)(),{friends:es}=(0,h.useFriends)(),ei=(0,r.useRef)(null),eo=(0,r.useRef)(null),ed={food:["🍕","🍔","🍜","🥘","🍛","🌮","🍱","🍝","🍲","🥗"],happy:["😊","😄","🎉","👏","🥳","✨","💫","😃","🙂","😁"],love:["❤️","💕","😍","🥰","💖","💝","🌹","💘","💗","😘"],travel:["✈️","🌍","🗺️","🏔️","🏖️","🚗","🎒","🏕️","🚁","🚂"],work:["💼","📊","💻","📈","⚙️","📝","✏️","📋","📌","🔧"],sports:["⚽","🏀","🏈","🎾","⛳","🏃‍♀️","🚴","🏊","🏋️","🎯"],music:["🎵","🎶","🎸","🎤","🎧","🎹","🎺","🎻","🥁","🎼"],nature:["🌳","🌸","🌺","🏞️","⛰️","🌊","☀️","🌙","⭐","🌿"],party:["🎉","🍾","🥂","🎊","🪩","💃","🕺","🎈","🎁","🎪"],coffee:["☕","🍵","☕️","🥤","🧊","🍯","🥛","🍰","🧁","🍪"]},{messages:ec,loading:eu,error:eg,sendMessage:em,editMessage:ex,isSending:eh}=function(e){let{chatId:t,limit:a=50}=e,{messages:l,sendMessage:n,loadChatMessages:s}=(0,g.useRealtime)(),{user:i}=(0,m.useAuth)(),[o,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(null),[h,f]=(0,r.useState)(!0),[y,p]=(0,r.useState)(!1),[b,v]=(0,r.useState)(0);(0,r.useRef)(null);let w=(0,r.useMemo)(()=>l.filter(e=>e.chat_id===t),[l,t]);(0,r.useEffect)(()=>{t&&(null==i?void 0:i.id)&&(async()=>{d(!0),u(null);try{await s(t),v(a),f(!0)}catch(e){u(e instanceof Error?e.message:"Failed to load messages")}finally{d(!1)}})()},[t,null==i?void 0:i.id,s]);let j=(0,r.useCallback)(async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(t&&(null==i?void 0:i.id)){d(!0),u(null);try{let r=await x.ChatsService.getChatMessages(t,i.id,a,e?0:b);e?v(a):v(e=>e+a),f(r.length===a)}catch(e){u(e instanceof Error?e.message:"Failed to load messages")}finally{d(!1)}}},[t,null==i?void 0:i.id,a,b]),k=(0,r.useCallback)(async()=>{h&&!o&&await j(!1)},[h,o,j]),N=(0,r.useCallback)(async(e,r)=>{if(e.trim()&&t&&!y){p(!0),u(null);try{await n(t,e,r)}catch(e){u(e instanceof Error?e.message:"Failed to send message")}finally{p(!1)}}},[t,n,y]);return{messages:w,loading:o,error:c,hasMore:h,loadMore:k,sendMessage:N,editMessage:(0,r.useCallback)(async(e,t)=>{if(t.trim())try{await x.ChatsService.editMessage(e,(null==i?void 0:i.id)||"",t)}catch(e){u(e instanceof Error?e.message:"Failed to edit message")}},[i]),deleteMessage:(0,r.useCallback)(async e=>{try{await x.ChatsService.deleteMessage(e,(null==i?void 0:i.id)||"")}catch(e){u(e instanceof Error?e.message:"Failed to delete message")}},[i]),isSending:y}}({chatId:_||"",limit:50}),ef=ee.find(e=>e.id===_),ey=(0,r.useCallback)(async()=>{if(S.trim()&&_&&!eh)try{D?(await ex(D.id,S.trim()),G(null)):(await em(S.trim(),null==z?void 0:z.id),B(null)),E("")}catch(e){console.error("Error sending message:",e)}},[S,_,eh,em,D,z]),ep=(0,r.useCallback)(e=>{B(e),G(null),E("")},[]),eb=(0,r.useCallback)(e=>{G(e),B(null),E(e.content)},[]),ev=(0,r.useCallback)(()=>{B(null),G(null),E("")},[]),ew=(0,r.useCallback)(async e=>{C(e);let t=ee.find(t=>t.id===e);t&&(et(t),await ea(e),setTimeout(()=>{eT()},100),setTimeout(()=>{eT()},300))},[ee,et,ea]),ej=(0,r.useCallback)(e=>{var t,r;let a=(null==(t=e.friend_profile)?void 0:t.username)||(null==(r=e.friend_profile)?void 0:r.full_name)||"Unknown",l=S.lastIndexOf("@friends"),n=S.substring(0,l),s=S.substring(S.lastIndexOf("@")+8),i=s;if(V){let e=s.indexOf("/");-1!==e&&(i=s.substring(e+1+V.length))}E(n+"@".concat(a," ")+i),Z(!1),$("")},[S,W,V]),ek=(0,r.useCallback)(e=>{if("Enter"!==e.key||e.shiftKey)"ArrowDown"===e.key&&Y&&H.length>0?(e.preventDefault(),Q(e=>e<H.length-1?e+1:0)):"ArrowUp"===e.key&&Y&&H.length>0?(e.preventDefault(),Q(e=>e>0?e-1:H.length-1)):"Escape"===e.key&&Y&&(e.preventDefault(),Z(!1),$(""));else{if(e.preventDefault(),Y&&H.length>0){let e=H[X];if(e)return void ej(e)}ey()}},[ey,Y,H,X,ej]),eN=(0,r.useCallback)(e=>{let t=e.target.value;E(t);let r=t.match(/#(\w+)$/);if(r){let e=r[1].toLowerCase();ed[e]?(M(ed[e]),O(!0),K(t.lastIndexOf("#")),Z(!1)):O(!1)}else O(!1);let a=t.match(/@friends(\/(.*))?$/);if(a&&es&&es.length>0){let e=a[2]||"";$(e);let r=es;e&&(r=es.filter(t=>{var r,a,l,n;let s=(null==(a=t.friend_profile)||null==(r=a.full_name)?void 0:r.toLowerCase())||"",i=(null==(n=t.friend_profile)||null==(l=n.username)?void 0:l.toLowerCase())||"";return e.toLowerCase().split(" ").filter(e=>e.length>0).every(e=>s.includes(e)||i.includes(e))})).sort((t,r)=>{var a,l,n,s;let i=((null==(a=t.friend_profile)?void 0:a.full_name)||(null==(l=t.friend_profile)?void 0:l.username)||"").toLowerCase(),o=((null==(n=r.friend_profile)?void 0:n.full_name)||(null==(s=r.friend_profile)?void 0:s.username)||"").toLowerCase(),d=i.startsWith(e),c=o.startsWith(e);return d&&!c?-1:!d&&c?1:i.localeCompare(o)}),q(r),Z(!0),J(t.lastIndexOf("@")),Q(0),O(!1)}else Z(!1),$("")},[ed,es]),e_=(0,r.useCallback)(e=>{let t=S.substring(0,U);E(t+e+" "+S.substring(S.lastIndexOf("#")+1)),O(!1)},[S,U]),eC=e=>{if("direct"===e.type){var t,r,a;let l=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==en?void 0:en.id));return(null==l||null==(r=l.user_profile)?void 0:r.full_name)||(null==l||null==(a=l.user_profile)?void 0:a.username)||"Unknown User"}return e.name||"Group Chat"},eS=e=>{if("direct"===e.type){var t,r;let a=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==en?void 0:en.id));return null==a||null==(r=a.user_profile)?void 0:r.avatar_url}return null},eE=(0,r.useMemo)(()=>ee.filter(e=>{var t,r;if(!A)return!0;let a=eC(e).toLowerCase(),l=(null==(r=e.last_message)||null==(t=r.content)?void 0:t.toLowerCase())||"";return a.includes(A.toLowerCase())||l.includes(A.toLowerCase())}),[ee,A]),eA=(0,r.useMemo)(()=>ee.reduce((e,t)=>e+(t.unread_count||0),0),[ee]),eT=(0,r.useCallback)(()=>{if(eo.current){let e=eo.current,t=e.scrollHeight-e.clientHeight;t-e.scrollTop<100?e.scrollTo({top:t,behavior:"smooth"}):e.scrollTop=t,L(!1)}},[]);return(0,r.useEffect)(()=>{if(ec.length>0){let e=()=>{eo.current&&(eo.current.scrollTop=eo.current.scrollHeight)};e(),requestAnimationFrame(()=>{e()}),setTimeout(()=>{e()},50)}},[ec.length,_,ec]),(0,t.jsxs)("div",{className:"flex h-full relative bg-gray-50 dark:bg-gray-900",children:[eu&&(0,t.jsx)("div",{className:"absolute inset-0 bg-white/80 dark:bg-gray-900/80 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading messages..."})]})}),(0,t.jsxs)("div",{className:"\n        ".concat(_?"hidden lg:flex":"flex","\n        w-full lg:w-80 xl:w-96 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-col\n        absolute lg:relative h-full z-30\n      "),children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("div",{className:"flex items-center flex-1",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[(0,t.jsx)("span",{className:"bg-gradient-to-r from-primary-500 to-accent-500 bg-clip-text text-transparent text-2xl lg:text-xl",children:"Moreno"}),(0,t.jsx)("span",{className:"hidden lg:inline text-gray-400 mx-2",children:"•"}),(0,t.jsx)("span",{className:"hidden lg:inline text-gray-900 dark:text-white",children:"Messages"})]}),(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 lg:hidden",children:"Messages"})]})}),eA>0&&(0,t.jsxs)("span",{className:"text-sm font-bold text-primary-700 dark:text-primary-400 bg-primary-100 dark:bg-primary-900/20 px-3 py-1.5 rounded-full border border-primary-200 dark:border-primary-800",children:[eA," new"]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(i.MagnifyingGlassIcon,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500 dark:text-gray-400"}),(0,t.jsx)("input",{type:"text",placeholder:"Search messages...",value:A,onChange:e=>T(e.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:bg-white dark:focus:bg-gray-600 transition-all font-medium text-gray-900 dark:text-white"})]})]}),(0,t.jsx)("div",{className:"overflow-y-auto flex-1 bg-gray-50 dark:bg-gray-900",children:0===eE.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8",children:[(0,t.jsx)(c.UserGroupIcon,{className:"w-16 h-16 text-gray-400 dark:text-gray-600 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-black mb-2",children:"No conversations yet"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-center",children:"Start a conversation with your friends to see messages here"})]}):eE.map(e=>(0,t.jsx)(p,{chat:e,user:en,isSelected:_===e.id,onSelect:ew,onlineFriends:el},e.id))})]}),_?(0,t.jsxs)("div",{className:"\n          flex-1 flex flex-col bg-white dark:bg-gray-800 relative\n          ".concat(_?"flex":"hidden lg:flex","\n          absolute lg:relative w-full h-full z-30\n        "),children:[(0,t.jsxs)("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b-2 border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center flex-1",children:[(0,t.jsx)("button",{onClick:()=>{C(null),et(null)},className:"lg:hidden mr-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(o,{className:"w-5 h-5 text-gray-700 dark:text-gray-300 font-bold"})}),(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[eS(ef)?(0,t.jsx)("img",{src:eS(ef),alt:eC(ef),className:"w-11 h-11 rounded-full object-cover shadow-md"}):(0,t.jsx)("div",{className:"w-11 h-11 bg-gradient-to-br from-primary-500 to-accent-500 rounded-full flex items-center justify-center text-white font-bold text-base shadow-md",children:(e=>{var t,r,a,l,n,s;if("direct"===e.type){let t=null==(r=e.participants)?void 0:r.find(e=>e.user_id!==(null==en?void 0:en.id));return(null==t||null==(l=t.user_profile)||null==(a=l.full_name)?void 0:a[0])||(null==t||null==(s=t.user_profile)||null==(n=s.username)?void 0:n[0])||"?"}return(null==(t=e.name)?void 0:t[0])||"G"})(ef)}),(e=>{if("direct"===e.type){var t;let r=null==(t=e.participants)?void 0:t.find(e=>e.user_id!==(null==en?void 0:en.id));return r&&el.includes(r.user_id)}return!1})(ef)&&(0,t.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-green-500 rounded-full border-2 border-white dark:border-gray-800 shadow-sm"})]}),(0,t.jsxs)("div",{className:"ml-3 min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("h3",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-white truncate",children:eC(ef)}),(null==ef?void 0:ef.type)==="direct"&&(()=>{var e,r,a;let l=null==(e=ef.participants)?void 0:e.find(e=>e.user_id!==(null==en?void 0:en.id)),n=(e=>{if(!e)return"";let t=y.countries.find(t=>t.name===e);return console.log("🔍 Debug flag lookup:",{countryName:e,found:!!t,flag:null==t?void 0:t.flag}),(null==t?void 0:t.flag)||""})((null==l||null==(r=l.user_profile)?void 0:r.location)||void 0);return n?(0,t.jsx)("span",{className:"text-lg",title:(null==l||null==(a=l.user_profile)?void 0:a.location)||void 0,children:n}):null})()]}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsx)(f.StatusIndicator,{userId:(null==ef||null==(b=ef.participants)||null==(e=b.find(e=>e.user_id!==(null==en?void 0:en.id)))?void 0:e.user_id)||"",size:"sm",showText:!0})})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[(0,t.jsx)("button",{className:"p-2 sm:p-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(l.PhoneIcon,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-700 dark:text-gray-300"})}),(0,t.jsx)("button",{className:"p-2 sm:p-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(n,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-700 dark:text-gray-300"})}),(0,t.jsx)("button",{className:"hidden sm:block p-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(i.MagnifyingGlassIcon,{className:"w-6 h-6 text-gray-700 dark:text-gray-300"})}),(0,t.jsx)("button",{className:"p-2 sm:p-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(s,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-700 dark:text-gray-300"})})]})]}),(0,t.jsxs)("div",{ref:eo,onScroll:()=>{if(eo.current){let{scrollTop:e,scrollHeight:t,clientHeight:r}=eo.current;L(!(t-e-r<100))}},className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4 pb-24 bg-gradient-to-b from-gray-50 to-white dark:from-gray-900 dark:to-gray-800 relative",children:[eu?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):eg?(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-red-600 dark:text-red-400",children:eg})}):0===ec.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,t.jsx)(d.ChatBubbleLeftRightIcon,{className:"w-16 h-16 text-gray-400 dark:text-gray-600 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-black mb-2",children:"No messages yet"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-center",children:"Start the conversation by sending a message"})]}):(0,t.jsxs)("div",{className:"space-y-4 max-w-4xl mx-auto",children:[ec.map(e=>{var r,a;let l=e.sender_id===(null==en?void 0:en.id),n=null==ef||null==(a=ef.participants)||null==(r=a.find(e=>e.user_id!==(null==en?void 0:en.id)))?void 0:r.user_profile;return(0,t.jsx)(F,{message:e,isOwnMessage:l,user:en,otherUserProfile:n,onReply:ep,onEdit:eb},e.id)}),(0,t.jsx)("div",{ref:ei})]}),I&&(0,t.jsx)("button",{onClick:eT,className:"fixed bottom-20 right-6 z-40 bg-primary-600 hover:bg-primary-700 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-105","aria-label":"Scroll to bottom",children:(0,t.jsx)(u.ChevronDownIcon,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 px-3 sm:px-4 py-3 sm:py-4 border-t-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-lg z-30",children:[(z||D)&&(0,t.jsxs)("div",{className:"mb-3 px-4 py-2 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(D?"bg-yellow-500":"bg-blue-500")}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:D?"Editing message":"Replying to"}),(0,t.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:(null==z||null==(v=z.sender_profile)?void 0:v.full_name)||(null==z||null==(w=z.sender_profile)?void 0:w.username)||"Unknown"})]}),(0,t.jsx)("button",{onClick:ev,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(z||D)&&(0,t.jsx)("div",{className:"mt-2 p-2 bg-white dark:bg-gray-600 rounded border border-gray-200 dark:border-gray-500",children:(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 truncate",children:null==(j=z||D)?void 0:j.content})})]}),(0,t.jsx)("div",{className:"flex items-center justify-center max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl relative",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3 bg-gray-100 dark:bg-gray-700 rounded-full px-4 py-2 border border-gray-300 dark:border-gray-600 focus-within:ring-2 focus-within:ring-primary-500 focus-within:bg-white dark:focus-within:bg-gray-600 focus-within:border-primary-500 transition-all",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-2 border-gray-300 dark:border-gray-600 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:(0,t.jsx)("span",{className:"text-black font-semibold text-sm",children:(null==en||null==(N=en.email)||null==(k=N[0])?void 0:k.toUpperCase())||"U"})}),(0,t.jsx)("input",{type:"text",value:S,onChange:eN,onKeyPress:ek,placeholder:"Type a message...",disabled:eh,className:"flex-1 bg-transparent border-none outline-none text-sm sm:text-base font-medium text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 disabled:opacity-50"}),(0,t.jsx)("button",{onClick:ey,disabled:eh||!S.trim(),className:"w-8 h-8 bg-blue-700 text-white rounded-full flex items-center justify-center transition-all duration-200 hover:scale-105 flex-shrink-0 ".concat(S.trim()?"bg-primary-400 hover:bg-primary-700 text-black cursor-pointer":"bg-gray-700 text-white dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"," ").concat(eh?"opacity-50 cursor-not-allowed":""),children:eh?(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-t-transparent rounded-full animate-spin ".concat(S.trim()?"border-white":"border-gray-500 dark:border-gray-400")}):(0,t.jsx)(a,{className:"w-4 h-4"})})]}),P&&R.length>0&&(0,t.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50 p-3",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:R.map((e,r)=>(0,t.jsx)("button",{onClick:()=>e_(e),className:"text-2xl hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg p-2 transition-colors",title:"Insert ".concat(e),children:e},r))})}),Y&&H.length>0&&(0,t.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50 p-3 max-h-60 overflow-y-auto",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("div",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:V?'Friends matching "'.concat(V,'"'):"Share a friend:"}),(0,t.jsxs)("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:[H.length," ",1===H.length?"friend":"friends"]})]}),0===H.length&&V?(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:['No friends found matching "',V,'"']}),(0,t.jsx)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Try a different name or username"})]}):H.map((e,r)=>{var a,l,n,s,i,o,d;return(0,t.jsxs)("button",{onClick:()=>ej(e),className:"flex items-center space-x-3 w-full p-2 rounded-lg transition-colors ".concat(r===X?"bg-primary-100 dark:bg-primary-900/20 border border-primary-300 dark:border-primary-700":"hover:bg-gray-100 dark:hover:bg-gray-700"),children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:(null==(a=e.friend_profile)?void 0:a.avatar_url)?(0,t.jsx)("img",{src:e.friend_profile.avatar_url,alt:e.friend_profile.full_name||"Friend",className:"w-8 h-8 rounded-full object-cover"}):(0,t.jsx)("span",{children:((null==(l=e.friend_profile)?void 0:l.full_name)||(null==(n=e.friend_profile)?void 0:n.username)||"F")[0].toUpperCase()})}),(0,t.jsxs)("div",{className:"flex-1 text-left min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:(null==(s=e.friend_profile)?void 0:s.full_name)||(null==(i=e.friend_profile)?void 0:i.username)||"Unknown Friend"}),(null==(o=e.friend_profile)?void 0:o.username)&&(null==(d=e.friend_profile)?void 0:d.full_name)&&(0,t.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:["@",e.friend_profile.username]})]})]},e.id)}),!V&&(0,t.jsx)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:"💡 Tip: Type @friends/name to filter friends"})]})})]})})]})]}):(0,t.jsx)("div",{className:"hidden lg:flex flex-1 items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-28 h-28 mx-auto mb-4 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center shadow-md",children:(0,t.jsx)(d.ChatBubbleLeftRightIcon,{className:"w-14 h-14 text-gray-500 dark:text-gray-400"})}),(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Select a conversation"}),(0,t.jsx)("p",{className:"text-base font-medium text-gray-600 dark:text-gray-400",children:"Choose a chat from the list to start messaging"})]})})]})}F.displayName="MessageBubble"}]);